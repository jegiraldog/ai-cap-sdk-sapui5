<mvc:View controllerName="com.globant.aichat.aichatpdfui5.controller.Home"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.f"
    xmlns:layout="sap.ui.layout"
    xmlns:unified="sap.ui.unified">
    
    <Page id="page" showHeader="false" class="sapUiContentPadding">
        <content>
            <!-- Header Section -->
            <VBox class="sapUiMediumMarginBottom">
                <HBox alignItems="Center" class="sapUiMediumMarginBottom">
                    <Avatar src="sap-icon://robot" displaySize="M" backgroundColor="Accent6" class="sapUiTinyMarginEnd"/>
                    <Title text="AI CAP SDK - Chat &amp; PDF Demo" level="H1" class="sapUiMediumMarginEnd"/>
                </HBox>
                
                <Text visible="false" text="Conectado a SAP AI Core - SelecciÃ³n dinÃ¡mica de modelos disponibles" class="sapUiMediumMarginBottom"/>
                
            </VBox>

            <!-- Model Selection Panel -->
            <Panel headerText="ðŸ¤– Seleccionar Modelo" 
                   expandable="false" 
                   class="sapUiMediumMarginBottom">
                <content>
                    <VBox class="sapUiContentPadding">
                        <ComboBox 
                            id="modelComboBox"
                            placeholder="Seleccionar modelo..."
                            items="{path: '/getAvailableModels'}"
                            width="100%">
                            <core:Item key="{id}" text="{modelName}" />
                        </ComboBox>
                    </VBox>
                </content>
            </Panel>

            <!-- Tab Container for Chat and PDF Analysis -->
            <IconTabBar id="tabBar" 
                       selectedKey="chatTab" 
                       class="sapUiResponsiveContentPadding"
                       expandable="false">
                
                <!-- Chat General Tab -->
                <items>
                    <IconTabFilter key="chatTab" 
                                  text="Chat General" 
                                  icon="sap-icon://discussion-2"
                                  iconColor="Default">
                        <content>
                            <VBox class="sapUiMediumMarginTop">
                                <!-- Chat Input Area -->
                                <VBox width="100%" class="sapUiMediumMarginBottom">
                                    <TextArea id="chatInput"
                                             placeholder="Haz una pregunta..."
                                             rows="4"
                                             width="100%"
                                             class="sapUiMediumMarginBottom"/>
                                    <HBox width="100%" justifyContent="End" alignItems="Center">
                                        <BusyIndicator id="askBusyIndicator" 
                                                     visible="false" 
                                                     size="1rem" 
                                                     class="sapUiTinyMarginEnd"/>
                                        <Button id="askButton"
                                               text="Preguntar"
                                               type="Emphasized"
                                               icon="sap-icon://paper-plane"
                                               press="onAskQuestion"/>
                                    </HBox>
                                </VBox>
                                
                                <!-- Chat Messages Area -->
                                <ScrollContainer id="chatContainer"
                                               height="400px"
                                               vertical="true"
                                               class="sapUiMediumMarginTop">
                                    <VBox id="chatMessages" class="sapUiContentPadding" items="{chat>/messages}">
                                        <VBox class="sapUiTinyMarginBottom">
                                            <MessageStrip 
                                                visible="{= ${chat>type} !== 'assistant' || ${chat>isLoading} === true}"
                                                text="{chat>text}"
                                                type="{parts: ['chat>type'], formatter: '.formatMessageType'}"
                                                showIcon="true">
                                                <customData>
                                                    <core:CustomData key="messageType" value="{chat>type}"/>
                                                    <core:CustomData key="timestamp" value="{chat>timestamp}"/>
                                                </customData>
                                            </MessageStrip>
                                            <Panel visible="{= ${chat>type} === 'assistant' &amp;&amp; ${chat>isLoading} !== true}"
                                                   class="sapUiNoContentPadding"
                                                   backgroundDesign="Transparent">
                                                <content>
                                                    <VBox class="sapUiContentPadding">
                                                        <HBox alignItems="Center" class="sapUiTinyMarginBottom">
                                                            <core:Icon src="sap-icon://robot" color="Positive" class="sapUiTinyMarginEnd"/>
                                                            <Text text="ðŸ¤– Asistente IA - Modelo: {chat>model}" class="sapUiTinyText"/>
                                                            <Text text="{chat>timestamp}" class="sapUiTinyText sapUiTinyMarginBegin"/>
                                                        </HBox>
                                                        <FormattedText htmlText="{parts: ['chat>text'], formatter: '.formatMarkdownToHtml'}" 
                                                                      class="sapUiSmallMarginTop"/>
                                                        <HBox visible="{= ${chat>model} !== null}" 
                                                              alignItems="Center" 
                                                              class="sapUiTinyMarginTop"
                                                              justifyContent="SpaceBetween">
                                                        </HBox>
                                                    </VBox>
                                                </content>
                                            </Panel>
                                        </VBox>
                                    </VBox>
                                </ScrollContainer>
                            </VBox>
                        </content>
                    </IconTabFilter>

                    <!-- PDF Analysis Tab -->
                    <IconTabFilter key="pdfTab" 
                                   enabled="false"
                                  text="AnÃ¡lisis PDF" 
                                  icon="sap-icon://pdf-attachment"
                                  iconColor="Default">
                        <content>
                            <VBox class="sapUiMediumMarginTop">
                                <!-- PDF Upload Area -->
                                <Panel headerText="Subir PDF para anÃ¡lisis" class="sapUiMediumMarginBottom">
                                    <content>
                                        <VBox class="sapUiContentPadding">
                                            <items>
                                                <unified:FileUploader id="pdfUploader"
                                                            name="pdfFile"
                                                            uploadUrl=""
                                                            tooltip="Seleccionar archivo PDF"
                                                            fileType="pdf"
                                                            maximumFileSize="10"
                                                            class="sapUiMediumMarginBottom"/>
                                                <Button text="Analizar PDF" 
                                                       type="Emphasized" 
                                                       icon="sap-icon://document-text"
                                                       press="onAnalyzePDF"/>
                                            </items>
                                        </VBox>
                                    </content>
                                </Panel>

                                <!-- PDF Analysis Results -->
                                <ScrollContainer height="350px" vertical="true">
                                    <VBox id="pdfAnalysisResults" class="sapUiContentPadding">
                                        <MessageStrip text="Sube un archivo PDF para comenzar el anÃ¡lisis" 
                                                     type="Information" 
                                                     showIcon="true"/>
                                    </VBox>
                                </ScrollContainer>
                            </VBox>
                        </content>
                    </IconTabFilter>
                </items>
            </IconTabBar>
        </content>
    </Page>
</mvc:View>
